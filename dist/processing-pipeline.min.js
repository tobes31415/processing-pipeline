!function(e,r){if("object"==typeof exports&&"object"==typeof module)module.exports=r();else if("function"==typeof define&&define.amd)define([],r);else{var t=r();for(var o in t)("object"==typeof exports?exports:e)[o]=t[o]}}(this,function(){return function(e){function r(o){if(t[o])return t[o].exports;var n=t[o]={exports:{},id:o,loaded:!1};return e[o].call(n.exports,n,n.exports,r),n.loaded=!0,n.exports}var t={};return r.m=e,r.c=t,r.p="",r(r.s=8)}([function(e,r,t){function o(){"use strict";return new n.a}var n=t(7),i=t(6);r.create=o,i.a.PipelineFactory={create:o}},function(e,r,t){function o(){"use strict";function e(){i={}}function r(e){if(!e)throw new Error("CacheContext cannot be null");if("object"!=typeof e&&"function"!=typeof e)throw new Error("CacheContext must be an object or function");var r=e[n];return r||(r=""+Math.floor(99999*Math.random()),e[n]=r),r}function t(){var e=Array.prototype.slice.call(arguments,0),t=e.reduce(function(e,t){return(""|e)+r(t)+"|"}),o=i[t];return o||(o={},i[t]=o),o}var o=this,i={};o.clear=e,o.get=t}r.a=o;const n=Symbol("cacheManagerContext")},function(e,r,t){function o(e,r){return e.reduce(function(e,t){var o=r.changed[t]||!1;return o||(o=i(t,r).detectChanges(t,r),o&&(r.changed[t]=!0)),e||o},null)}function n(e){for(var r in e.changed)i(r,e).updateHistory(r,e)}function i(e,r){var t=r.model[e+u]||d;if("object"==typeof t){if("function"==typeof t.detectChanges&&"function"==typeof t.updateHistory)return t;throw new Error("When specifiying a custom mode you must supply a detectChanges function, and an updateHistory function")}if("string"!=typeof t)throw new Error("Only String and Object are allowed values for ChangeMode");if(t=t.toLowerCase(),t===a)return s;if(t===f)return c;throw new Error("Change detection mode not recognized")}var s=t(4),c=t(3);r.detectChanges=o,r.updateHistory=n;const u="_ChangeMode",a="json",f="identity",d=a},function(e,r,t){function o(e,r){var t=r.model[e],o=r.history[e];if(void 0===o!=(void 0===t))return!0;if(void 0===t)return!1;if("object"==typeof t){var n={},i=[];for(var s in t)i.push(s);for(var c in o)i.push(c);for(var u=0;u<i.length;u++){var a=i[u];if(!n[a]&&(n[a]=!0,t[a]!==o[a]))return!0}return!1}return o!==t}function n(e,r){var t=r.model[e];if(void 0===t)delete r.history[e];else if("object"==typeof t){r.history[e]=r.history[e]||{};for(var o in t)r.history[e][o]=t[o]}else r.history[e]=r.model[e]}r.detectChanges=o,r.updateHistory=n},function(e,r,t){function o(e,r){return void 0===r.history[e]!=(void 0===r.model[e])||void 0!==r.model[e]&&JSON.stringify(r.model[e])!==r.history[e]}function n(e,r){"undefined"===r.model[e]?delete r.history[e]:r.history[e]=JSON.stringify(r.model[e])}r.detectChanges=o,r.updateHistory=n},function(e,r,t){function o(){var e=this||{};return e.promise=new Promise(function(r,t){e.resolve=r,e.reject=t}),e}r.a=o},function(e,r,t){(function(e){function t(){var r;if(function(){r=this}(),!r){try{r=window}catch(t){}try{r=e}catch(t){}}return r||{}}r.a=t()}).call(r,function(){return this}())},function(e,r,t){function o(){"use strict";function e(e,r){if(b)return m.suppressConsole||console.error("Can't accept new process request because the pipeline is halted"),Promise.reject("pipeline is halted");var t=s.a();return g.push({deferred:t,model:e,processor:r||a}),o(),t.promise}function r(){b=!0}function t(){b=!1,g=[],g.push({model:{},processor:C.clear}),o()}function o(){if(!b&&!j&&g.length>0){var e=g.shift(),r={model:e.model,history:x,changed:{}},t=function(){j=!1,i.updateHistory(r),setTimeout(o,0)},n=d(r,e.processor);n["catch"](f(e.deferred.reject)),n.then(t,t),n.then(e.deferred.resolve,e.deferred.resolve)}}function f(e){return function(r){w===c?(m.halt(),m.suppressConsole||console.error(r),e(r)):w===u?m.suppressConsole||console.warn(r):console.error("Wait... what?")}}function d(e,r){if(!r)throw new Error("Processor undefined");if(b)return Promise.resolve();var t;if("function"==typeof r?t=h:"string"==typeof r?t=l:Array.isArray(r)?t=y:"object"==typeof r&&(t=p),!t)throw new Error("Not sure how to run processor",r);try{return t(e,r)}catch(o){return Promise.reject(o)}}function h(e,r){return Promise.resolve(r({model:e.model,changed:e.changed,cache:C.get(m,r)}))}function l(e,r){var t,o=r.toLowerCase();if(e.model&&e.model.processors&&(t=e.model.processors[o]),t||(t=m.processors[o]),!t)throw new Error("Couldn't find processor "+o);return d(e,t)}function p(e,r){if(!r.runs||"string"!=typeof r.runs&&"object"!=typeof r.runs&&"function"!=typeof r.runs)throw new Error("Object based processor must have a 'runs' property containing a processor defintion");var t=!0;return"string"==typeof r.watches&&(r.watches=[r.watches]),Array.isArray(r.watches)&&(t=i.detectChanges(r.watches,e)),t?d(e,r.runs):Promise.resolve()}function y(e,r){return new Promise(function(t,o){function n(){if(0===i.length)t();else{var r=d(e,i.shift());r["catch"](f(o)),r.then(n,n)}}var i=r.slice();n()})}function v(e){if(e!==c&&e!==u)throw new Error("On fail only accepts a single string value which must be exactly 'halt' or 'warn'");w=e}var m=this,w=u,g=[],C=new n.a,b=!1,j=!1,x={};m.processors={},m.process=e,m.halt=r,m.restart=t,m.onFail=v,m.suppressConsole=!1}var n=t(1),i=t(2),s=t(5);r.a=o;const c="halt",u="warn",a="start"},function(e,r,t){e.exports=t(0)}])});